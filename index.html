<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph·∫ßn M·ªÅm In Phi·∫øu Thu Viettel</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            prefix: 'tw-',
        }
    </script>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- ExcelJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <!-- FileSaver.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <!-- JSZip -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- SheetJS for Receipt Import -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

</head>

<body>
    <!-- Login Overlay -->
    <div id="login-overlay" class="login-overlay">
        <div class="login-box">
            <h2 style="color: #EE0033; margin-bottom: 20px;">ƒêƒÇNG NH·∫¨P H·ªÜ TH·ªêNG</h2>
            <input type="password" id="passwordInput" placeholder="Nh·∫≠p m·∫≠t kh·∫©u..." />
            <div id="loginError" style="color: red; margin-top: 10px; display: none;">M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!</div>
            <button id="btnLogin" class="btn-primary" style="width: 100%; margin-top: 20px;">ƒêƒÇNG NH·∫¨P</button>
        </div>
    </div>

    <div class="app-container" style="display: none;">
        <!-- Sidebar / Settings Panel -->
        <aside class="sidebar">
            <div class="brand">
                <h2>VIETTEL RECEIPT</h2>
            </div>

            <!-- Navigation -->
            <div class="nav-menu" style="margin-bottom: 20px;">
                <button id="nav-receipt" class="nav-btn active"
                    style="width:100%; text-align:left; padding:10px; margin-bottom:5px; background:#e63946; color:white; border:none; cursor:pointer; border-radius: 4px; font-weight: 500;">üßæ
                    In Phi·∫øu Thu</button>
                <button id="nav-excel" class="nav-btn"
                    style="width:100%; text-align:left; padding:10px; background:transparent; color:#333; border:none; cursor:pointer; border-radius: 4px; font-weight: 500;">üìä
                    C√¥ng C·ª• Excel</button>
            </div>

            <!-- Receipt Settings (Visible only in Receipt View ideally, but keeping in sidebar is fine) -->
            <div id="sidebar-receipt-settings" class="settings-group">
                <h3>Th√¥ng Tin Ng∆∞·ªùi Thu</h3>
                <label>H·ªç t√™n ng∆∞·ªùi thu:</label>
                <input type="text" id="collectorName" value="L√ä TR·ªåNG AN">

                <label>SƒêT ng∆∞·ªùi thu:</label>
                <input type="text" id="collectorPhone" value="0869 121 952">

                <label>ƒê∆°n v·ªã thu:</label>
                <input type="text" id="unitName" value="VIETTEL L√ÇM ƒê·ªíNG - VIETTEL DI LINH">

                <h3 style="margin-top:15px">Th√¥ng Tin K·ª≥ C∆∞·ªõc</h3>
                <label>Th√°ng/NƒÉm:</label>
                <input type="month" id="billingMonth" value="2026-01">
                <div class="mini-hint">Ng√†y in m·∫∑c ƒë·ªãnh l√† h√¥m nay.</div>
            </div>

            <div id="sidebar-receipt-actions" class="actions">
                <button id="btnPrint" class="btn-primary">üñ®Ô∏è IN PHI·∫æU (Ctrl+P)</button>
                <button id="btnExport" class="btn-secondary">üíæ L∆ØU D·ªÆ LI·ªÜU</button>
            </div>

            <div class="footer-note">
                <p>Copyright ¬© 2026</p>
                <div style="font-size: 10px; color: #999; margin-top: 5px;">Created by AntiGravity</div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">

            <!-- VIEW 1: RECEIPT PRINTING -->
            <div id="view-receipt" class="app-view active">
                <header>
                    <h1>Danh S√°ch Kh√°ch H√†ng</h1>
                    <div class="header-actions">
                        <input type="file" id="fileInput" accept=".xlsx, .xls" style="display:none;" />
                        <button id="btnDownloadSample" class="btn-secondary"
                            style="margin-right: 5px; font-size: 13px;">‚¨áÔ∏è
                            T·∫£i file m·∫´u</button>
                        <button id="btnImport" class="btn-secondary" style="margin-right: 10px;">üìÇ Nh·∫≠p t·ª´
                            Excel</button>
                        <button id="btnAddRow" class="btn-add">+ Th√™m Kh√°ch H√†ng</button>
                    </div>
                </header>

                <div class="table-container">
                    <table id="customerTable">
                        <thead>
                            <tr>
                                <th style="width: 50px;">STT</th>
                                <th>M√£ Kh√°ch H√†ng (Account)</th>
                                <th>T√™n Kh√°ch H√†ng</th>
                                <th>SƒêT Li√™n H·ªá</th>
                                <th>ƒê·ªãa Ch·ªâ</th>
                                <th>T·ªïng C∆∞·ªõc</th>
                                <th>H√†nh ƒê·ªông</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rows will be added here by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- VIEW 2: EXCEL TOOL -->
            <div id="view-excel" class="app-view">
                <div class="tw-max-w-4xl tw-mx-auto tw-bg-white tw-rounded-lg tw-shadow-lg tw-p-6">
                    <h1 class="tw-text-2xl tw-font-bold tw-text-gray-800 tw-mb-6 tw-flex tw-items-center tw-gap-2">
                        <svg class="tw-w-6 tw-h-6 tw-text-green-600" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                            </path>
                        </svg>
                        L·ªçc Excel & Gi·ªØ ƒê·ªãnh D·∫°ng
                    </h1>

                    <!-- File Input -->
                    <div class="tw-mb-6 tw-grid tw-grid-cols-12 tw-gap-4 tw-items-center">
                        <label class="tw-col-span-2 tw-text-gray-700 tw-font-medium">File ngu·ªìn (.xlsx):</label>
                        <div
                            class="tw-col-span-8 tw-flex tw-items-center tw-border tw-rounded tw-px-3 tw-py-2 tw-bg-gray-50">
                            <input type="file" id="et-inputFile" accept=".xlsx, .xls"
                                class="tw-w-full tw-text-sm tw-text-gray-500 file:tw-mr-4 file:tw-py-2 file:tw-px-4 file:tw-rounded-full file:tw-border-0 file:tw-text-sm file:tw-font-semibold file:tw-bg-blue-50 file:tw-text-blue-700 hover:file:tw-bg-blue-100">
                        </div>
                        <div class="tw-col-span-2 tw-text-right">
                            <span id="et-fileStatus" class="tw-text-xs tw-text-gray-400">Ch∆∞a ch·ªçn file</span>
                        </div>
                    </div>

                    <!-- Filter Section -->
                    <div class="tw-mb-6 tw-border tw-rounded-lg tw-overflow-hidden">
                        <div
                            class="tw-bg-gray-100 tw-px-4 tw-py-2 tw-border-b tw-flex tw-justify-between tw-items-center">
                            <h3 class="tw-font-semibold tw-text-gray-700">B·ªô l·ªçc (AND gi·ªØa c·ªôt, OR trong m·ªói c·ªôt)</h3>
                            <button id="et-addFilterRow" class="tw-text-blue-600 tw-text-sm hover:tw-underline">+ Th√™m
                                d√≤ng l·ªçc</button>
                        </div>
                        <div class="tw-p-4 tw-bg-white" id="et-filterContainer">
                            <div
                                class="tw-grid tw-grid-cols-12 tw-gap-4 tw-mb-2 tw-font-medium tw-text-sm tw-text-gray-500">
                                <div class="tw-col-span-4">T√™n c·ªôt (Header ch√≠nh x√°c)</div>
                                <div class="tw-col-span-8">Gi√° tr·ªã (c√°ch nhau b·∫±ng d·∫•u ph·∫©y)</div>
                            </div>
                            <!-- Helper text -->
                            <div class="tw-text-xs tw-text-gray-400 tw-mb-4 tw-italic">
                                V√≠ d·ª•: C·ªôt "M√£ CTV" l·ªçc gi√° tr·ªã "CTV01, CTV02". (Kh√¥ng ph√¢n bi·ªát hoa th∆∞·ªùng)
                            </div>

                            <!-- Filter Rows generated by JS -->
                            <div id="et-filterRows"></div>
                        </div>
                    </div>

                    <!-- Output Options -->
                    <div class="tw-mb-6 tw-bg-gray-50 tw-p-4 tw-rounded-lg">
                        <div class="tw-flex tw-items-center tw-gap-6 tw-mb-4">
                            <span class="tw-font-medium tw-text-gray-700">Ch·∫ø ƒë·ªô xu·∫•t:</span>
                            <label class="tw-inline-flex tw-items-center tw-cursor-pointer">
                                <input type="radio" name="et-outputMode" value="merge"
                                    class="tw-form-radio tw-text-blue-600" checked>
                                <span class="tw-ml-2">1) G·ªôp t·∫•t c·∫£ v√†o 1 file</span>
                            </label>
                            <label class="tw-inline-flex tw-items-center tw-cursor-pointer">
                                <input type="radio" name="et-outputMode" value="auto"
                                    class="tw-form-radio tw-text-blue-600">
                                <span class="tw-ml-2">3) T√°ch T·ª∞ ƒê·ªòNG theo gi√° tr·ªã c·ªôt</span>
                            </label>
                        </div>

                        <!-- Split Settings (Conditional) -->
                        <div id="et-splitSettings" class="tw-hidden tw-pl-4 tw-border-l-4 tw-border-blue-200 tw-ml-2">
                            <div class="tw-grid tw-grid-cols-12 tw-gap-4 tw-items-center tw-mb-2">
                                <label class="tw-col-span-3 tw-text-sm tw-font-medium">C·ªôt ƒë·ªÉ t√°ch file:</label>
                                <input type="text" id="et-splitColumn" placeholder="Nh·∫≠p t√™n c·ªôt (VD: M√£ CTV)"
                                    class="tw-col-span-9 tw-border tw-rounded tw-px-3 tw-py-2 tw-text-sm focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="tw-flex tw-justify-center tw-gap-4 tw-mt-6">
                        <button id="et-btnRun"
                            class="tw-bg-blue-600 hover:tw-bg-blue-700 tw-text-white tw-font-bold tw-py-3 tw-px-8 tw-rounded tw-shadow-lg tw-transform tw-transition hover:tw-scale-105 tw-flex tw-items-center">
                            <span id="et-loadingSpinner" class="tw-hidden tw-mr-2">
                                <svg class="tw-animate-spin tw-h-5 tw-w-5 tw-text-white"
                                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="tw-opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        stroke-width="4">
                                    </circle>
                                    <path class="tw-opacity-75" fill="currentColor"
                                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                    </path>
                                </svg>
                            </span>
                            Ch·∫°y X·ª≠ L√Ω
                        </button>
                    </div>

                    <div id="et-statusMessage"
                        class="tw-mt-4 tw-text-center tw-text-sm tw-font-medium tw-text-gray-600 tw-min-h-[20px]"></div>

                </div>
            </div>
        </main>
    </div>

    <!-- PRINT SECTION (Hidden on Screen) -->
    <div id="printArea">
        <!-- Receipts will be injected here -->
    </div>

    <script src="script.js"></script>
    <script src="excel-tool.js"></script>
</body>

</html>